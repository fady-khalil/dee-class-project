import{u as ie,r as l,j as e,C as re}from"./index-CUZ3IgtU.js";import{a as x}from"./DefaultLayout-CkCiLseG.js";import{R as oe,C as I,a as L,b as M,c as O,d as ce,E as de}from"./ResourceTable-C74f08gv.js";import{C as me,a as ue,b as ge}from"./CForm-mBsUD2F9.js";import{a as f,e as B}from"./index.esm-B2Pq-DPn.js";import"./CAlert-CT9IIZhY.js";import"./cil-user-Ddrdy7PS.js";const be=()=>{var V,$;const{canWrite:H}=ie(),r=H("courses"),[S,R]=l.useState([]),[U,q]=l.useState(!0),[W,g]=l.useState(!1),[j,A]=l.useState(!1),[a,h]=l.useState({title:"",title_ar:""}),[z,C]=l.useState(!1),[G,b]=l.useState(!1),[o,E]=l.useState(null),[w,u]=l.useState(""),[_,J]=l.useState(1),[v]=l.useState(10),[y,K]=l.useState(1),Q=[{header:"Title",accessor:t=>t.translations&&t.translations.en?t.translations.en.title:t.title||"N/A"},{header:"Slug",accessor:"slug"}];l.useEffect(()=>{N()},[]);const N=async()=>{try{const t=await x.get("/course-categories");R(t==null?void 0:t.data)}catch(t){console.error("Failed to fetch categories:",t)}finally{q(!1)}},F=()=>{r&&(A(!1),h({title:"",title_ar:"",slug:""}),u(""),g(!0))},k=async t=>{var s,c,d;A(!0),console.log("Starting edit for category:",t);try{let i;try{const p=`/course-categories/admin/${t.slug}`;console.log("Calling admin endpoint:",p),i=await x.get(p),console.log("Category data from admin API:",i),console.log("Category translations:",(s=i.data)==null?void 0:s.translations)}catch(p){console.error("Admin endpoint failed with error:",p),console.log("Falling back to regular endpoint"),i={data:t}}const n=i.data,m={id:n._id||n.id,slug:n.slug,title:"",title_ar:""};n.translations?(console.log("Found translations in category data:",n.translations),m.title=((c=n.translations.en)==null?void 0:c.title)||"",m.title_ar=((d=n.translations.ar)==null?void 0:d.title)||"",console.log("Extracted titles:",{title:m.title,title_ar:m.title_ar})):(console.log("No translations found, using legacy format"),m.title=n.title||""),console.log("Final formatted category:",m),h(m)}catch(i){console.error("Failed to fetch category data:",i)}u(""),g(!0)},D=(t,s)=>{s&&s.preventDefault(),K(t)},T=t=>{const{name:s,value:c}=t.target;u(""),h(d=>({...d,[s]:c}))},X=async t=>{t.preventDefault(),u("");try{j?await x.put(`/course-categories/${a.slug}`,{title:a.title,title_ar:a.title_ar}):await x.post("/course-categories",{title:a.title,title_ar:a.title_ar}),g(!1),h({title:"",title_ar:""}),N()}catch(s){console.error("Failed to save category:",s==null?void 0:s.message),u(`Failed to ${j?"update":"create"} category: ${(s==null?void 0:s.message)||"Unknown error occurred"}`)}},Y=t=>{E(t),b(!0)},Z=async()=>{try{await x.delete(`/course-categories/${o.slug}`),b(!1),E(null),N()}catch(t){console.error("Failed to delete category:",t)}},ee=t=>{var c,d,i,n;const s={...t,title:((d=(c=t.translations)==null?void 0:c.en)==null?void 0:d.title)||t.title||"N/A",title_ar:((n=(i=t.translations)==null?void 0:i.ar)==null?void 0:n.title)||"N/A"};h(s),C(!0)},P=_*v,te=P-v,se=S.slice(te,P),ae=Math.ceil(S.length/v),le=t=>{J(t)},ne=e.jsx(de,{title:"No Course Categories Found",message:"There are no course categories in the database yet.",actionLabel:r?"Add Category":null,onAction:r?F:null});return U?e.jsx("div",{className:"d-flex justify-content-center my-5",children:e.jsx(re,{color:"primary"})}):e.jsxs(e.Fragment,{children:[e.jsx(me,{children:e.jsxs(ue,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h4",{children:"Course Categories"}),r&&e.jsx(f,{color:"primary",onClick:F,children:"Add Category"})]}),e.jsx(oe,{columns:Q,data:se,resourceType:"courses",onView:ee,onEdit:r?k:void 0,onDelete:r?Y:void 0,pagination:{currentPage:_,totalPages:ae,onPageChange:le},emptyState:ne})]})}),e.jsxs(I,{placement:"end",visible:W,onHide:()=>{g(!1),u("")},children:[e.jsx(L,{children:e.jsx(M,{children:j?"Edit Category":"Add New Category"})}),e.jsx(O,{children:e.jsxs(ge,{onSubmit:X,children:[w&&e.jsx("div",{className:"alert alert-danger mb-3",children:w}),e.jsx("div",{className:"mb-3",children:e.jsxs("ul",{className:"nav nav-tabs",children:[e.jsx("li",{className:"nav-item",children:e.jsx("button",{className:`nav-link ${y===1?"active":""}`,onClick:t=>D(1,t),type:"button",children:"English"})}),e.jsx("li",{className:"nav-item",children:e.jsx("button",{className:`nav-link ${y===2?"active":""}`,onClick:t=>D(2,t),type:"button",children:"Arabic"})})]})}),e.jsx("div",{style:{display:y===1?"block":"none"},children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Title (English)"}),e.jsx(B,{type:"text",name:"title",value:a.title,onChange:T,required:!0})]})}),e.jsx("div",{style:{display:y===2?"block":"none"},children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Title (Arabic)"}),e.jsx(B,{type:"text",name:"title_ar",value:a.title_ar,onChange:T,required:!0,dir:"rtl"})]})}),e.jsxs("div",{className:"d-flex justify-content-end gap-2 mt-4",children:[e.jsx(f,{color:"secondary",onClick:()=>g(!1),children:"Cancel"}),e.jsx(f,{color:"primary",type:"submit",children:j?"Update":"Save"})]})]})})]}),e.jsxs(I,{placement:"end",visible:z,onHide:()=>C(!1),children:[e.jsx(L,{children:e.jsx(M,{children:"View Category"})}),e.jsxs(O,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"text-muted mb-2",children:"Category Name (English)"}),e.jsx("p",{className:"fs-5",children:a.title})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"text-muted mb-2",children:"Category Name (Arabic)"}),e.jsx("p",{className:"fs-5",dir:"rtl",children:a.title_ar})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"text-muted mb-2",children:"Slug"}),e.jsx("p",{className:"fs-5",children:a.slug})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"text-muted mb-2",children:"Created At"}),e.jsx("p",{className:"fs-5",children:new Date(a.createdAt).toLocaleDateString()})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"text-muted mb-2",children:"Last Updated"}),e.jsx("p",{className:"fs-5",children:new Date(a.updatedAt).toLocaleDateString()})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2 mt-4",children:[e.jsx(f,{color:"secondary",onClick:()=>C(!1),children:"Close"}),r&&e.jsx(f,{color:"warning",onClick:()=>{C(!1),k(a)},children:"Edit"})]})]})]}),e.jsx(ce,{visible:G,onClose:()=>b(!1),onConfirm:Z,itemName:(($=(V=o==null?void 0:o.translations)==null?void 0:V.en)==null?void 0:$.title)||(o==null?void 0:o.title),itemType:"category"})]})};export{be as default};
