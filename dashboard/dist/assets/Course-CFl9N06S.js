import{e as q,u as G,v as J,r as n,j as e,C as Q,B as X}from"./index-CUZ3IgtU.js";import{a as D}from"./DefaultLayout-CkCiLseG.js";import{R as Y,C as Z,a as ee,b as se,c as te,d as ae,E as ne}from"./ResourceTable-C74f08gv.js";import{C as re,a as ie}from"./CForm-mBsUD2F9.js";import{a as u}from"./index.esm-B2Pq-DPn.js";import"./CAlert-CT9IIZhY.js";import"./cil-user-Ddrdy7PS.js";const ge=()=>{var N,y,b,P,v,S,A,E,w,O,T,B;const m=q(),{canWrite:L}=G(),r=L("courses"),[V,h]=J(),[c,$]=n.useState([]),[F,g]=n.useState(!0),[I,o]=n.useState(!1),[a,R]=n.useState(null),[k,d]=n.useState(!1),[i,f]=n.useState(null),[l,H]=n.useState({currentPage:1,totalPages:1,totalCount:0,pageSize:10,hasNextPage:!1,hasPrevPage:!1}),M=[{header:"Title",accessor:s=>s.translations&&s.translations.en?s.translations.en.title:s.title||"N/A"},{header:"Category",accessor:s=>{const t=s.category;return t?t.translations&&t.translations.en?t.translations.en.title:t.title||"N/A":"N/A"}},{header:"Price",accessor:"price"}],x=parseInt(V.get("page"))||1;n.useEffect(()=>{C(x)},[x]);const C=async(s=1)=>{try{g(!0);const t=await D.get(`/courses?page=${s}&pageSize=10`);t!=null&&t.data&&$(t.data),t!=null&&t.pagination&&H(t.pagination)}catch(t){console.error("Failed to fetch courses:",t)}finally{g(!1)}},j=()=>{r&&m("/courses/new",{state:{isEditing:!1}})},p=s=>{m(`/courses/${s.slug}/edit`,{state:{isEditing:!0}})},W=s=>{f(s),d(!0)},z=async()=>{try{await D.delete(`/courses/${i.slug}`),d(!1),f(null);const s=l.currentPage;c.length===1&&l.currentPage>1?h({page:(s-1).toString()}):C(s)}catch(s){console.error("Failed to delete course:",s)}},K=s=>{R(s),o(!0)},U=s=>{h({page:s.toString()})},_=e.jsx(ne,{title:"No Courses Found",message:"There are no courses in the database yet.",actionLabel:r?"Add Course":null,onAction:r?j:null});return F?e.jsx("div",{className:"d-flex justify-content-center my-5",children:e.jsx(Q,{color:"primary"})}):e.jsxs(e.Fragment,{children:[e.jsx(re,{children:e.jsxs(ie,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{children:"Courses"}),l.totalCount>0&&e.jsxs("p",{className:"text-medium-emphasis",children:["Showing ",c.length," of ",l.totalCount," courses"]})]}),r&&e.jsx(u,{color:"primary",onClick:j,children:"Add Course"})]}),e.jsx(Y,{columns:M,data:c,resourceType:"courses",onView:K,onEdit:r?p:void 0,onDelete:r?W:void 0,pagination:{currentPage:l.currentPage,totalPages:l.totalPages,onPageChange:U},emptyState:_})]})}),a&&e.jsxs(Z,{placement:"end",visible:I,onHide:()=>o(!1),children:[e.jsx(ee,{children:e.jsx(se,{children:"Course Details"})}),e.jsxs(te,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"text-muted mb-2",children:"Title"}),e.jsx("p",{className:"fs-5",children:((y=(N=a.translations)==null?void 0:N.en)==null?void 0:y.title)||a.title||"N/A"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"text-muted mb-2",children:"Arabic Title"}),e.jsx("p",{className:"fs-5",dir:"rtl",children:((P=(b=a.translations)==null?void 0:b.ar)==null?void 0:P.title)||"N/A"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"text-muted mb-2",children:"Category"}),e.jsx("p",{className:"fs-5",children:((A=(S=(v=a.category)==null?void 0:v.translations)==null?void 0:S.en)==null?void 0:A.title)||((E=a.category)==null?void 0:E.title)||"N/A"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"text-muted mb-2",children:"Price"}),e.jsx("p",{className:"fs-5",children:a.price})]}),a.image&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"text-muted mb-2",children:"Image"}),e.jsx("img",{src:`${X}/${a.image.data||a.image}`,alt:((O=(w=a.translations)==null?void 0:w.en)==null?void 0:O.title)||a.title,className:"img-fluid rounded",style:{maxWidth:"100%",maxHeight:"200px"}})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2 mt-4",children:[e.jsx(u,{color:"secondary",onClick:()=>o(!1),children:"Close"}),r&&e.jsx(u,{color:"warning",onClick:()=>{o(!1),p(a)},children:"Edit"})]})]})]}),e.jsx(ae,{visible:k,onClose:()=>d(!1),onConfirm:z,itemName:((B=(T=i==null?void 0:i.translations)==null?void 0:T.en)==null?void 0:B.title)||(i==null?void 0:i.title),itemType:"course"})]})};export{ge as default};
