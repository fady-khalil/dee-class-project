import{u as ce,r as i,j as e,C as de}from"./index-wp0-z5g-.js";import{a as x,g as me}from"./DefaultLayout-DdBmS0sh.js";import{C as M,a as O,b as B,c as H,d as ue,E as ge}from"./ConfirmDeleteModal-DMJz_cck.js";import{R as he}from"./ResourceTable-BjYYhvxa.js";import{C as xe,a as fe,b as je}from"./CForm-DR_g0405.js";import{a as f,e as A}from"./index.esm-DPbDpRkl.js";import"./CAlert-D1Sj_uBa.js";import"./cil-user-Ddrdy7PS.js";var U={};const _e=()=>{var I,L,R,V;const{canWrite:W}=ce(),o=W("courses"),[_,q]=i.useState([]),[z,G]=i.useState(!0),[J,h]=i.useState(!1),[j,E]=i.useState(!1),[a,u]=i.useState({title:"",title_ar:"",status:"active",image:null}),[K,p]=i.useState(!1),[Q,v]=i.useState(!1),[c,F]=i.useState(null),[w,g]=i.useState(""),[k,X]=i.useState(1),[y]=i.useState(10),[C,Y]=i.useState(1),Z=[{header:"Title",accessor:t=>t.translations&&t.translations.en?t.translations.en.title:t.title||"N/A"},{header:"Slug",accessor:"slug"},{header:"Status",accessor:t=>{const s=t.status||"active";return e.jsx("span",{className:`badge ${s==="active"?"bg-success":"bg-warning text-dark"}`,children:s==="active"?"Active":"Coming Soon"})}}];i.useEffect(()=>{N()},[]);const N=async()=>{try{const t=await x.get("/course-categories");q(t==null?void 0:t.data)}catch(t){console.error("Failed to fetch categories:",t)}finally{G(!1)}},$=()=>{o&&(E(!1),u({title:"",title_ar:"",slug:"",status:"active",image:null}),g(""),h(!0))},D=async t=>{var s,r,d;E(!0),console.log("Starting edit for category:",t);try{let n;try{const b=`/course-categories/admin/${t.slug}`;console.log("Calling admin endpoint:",b),n=await x.get(b),console.log("Category data from admin API:",n),console.log("Category translations:",(s=n.data)==null?void 0:s.translations)}catch(b){console.error("Admin endpoint failed with error:",b),console.log("Falling back to regular endpoint"),n={data:t}}const l=n.data,m={id:l._id||l.id,slug:l.slug,title:"",title_ar:"",status:l.status||"active",image:l.image||null};l.translations?(console.log("Found translations in category data:",l.translations),m.title=((r=l.translations.en)==null?void 0:r.title)||"",m.title_ar=((d=l.translations.ar)==null?void 0:d.title)||"",console.log("Extracted titles:",{title:m.title,title_ar:m.title_ar})):(console.log("No translations found, using legacy format"),m.title=l.title||""),console.log("Final formatted category:",m),u(m)}catch(n){console.error("Failed to fetch category data:",n)}g(""),h(!0)},P=(t,s)=>{s&&s.preventDefault(),Y(t)},S=t=>{const{name:s,value:r}=t.target;g(""),u(d=>({...d,[s]:r}))},ee=async t=>{t.preventDefault(),g("");try{const s=new FormData;s.append("title",a.title),s.append("title_ar",a.title_ar),s.append("status",a.status),a.imageFile&&s.append("image",a.imageFile),j?await x.putWithFile(`/course-categories/${a.slug}`,s):await x.postWithFile("/course-categories",s),h(!1),u({title:"",title_ar:"",status:"active",image:null}),N()}catch(s){console.error("Failed to save category:",s==null?void 0:s.message),g(`Failed to ${j?"update":"create"} category: ${(s==null?void 0:s.message)||"Unknown error occurred"}`)}},te=t=>{F(t),v(!0)},se=async()=>{try{await x.delete(`/course-categories/${c.slug}`),v(!1),F(null),N()}catch(t){console.error("Failed to delete category:",t)}},ae=t=>{var r,d,n,l;const s={...t,title:((d=(r=t.translations)==null?void 0:r.en)==null?void 0:d.title)||t.title||"N/A",title_ar:((l=(n=t.translations)==null?void 0:n.ar)==null?void 0:l.title)||"N/A",status:t.status||"active",image:t.image||null};u(s),p(!0)},T=k*y,le=T-y,ie=_.slice(le,T),ne=Math.ceil(_.length/y),re=t=>{X(t)},oe=e.jsx(ge,{title:"No Course Categories Found",message:"There are no course categories in the database yet.",actionLabel:o?"Add Category":null,onAction:o?$:null});return z?e.jsx("div",{className:"d-flex justify-content-center my-5",children:e.jsx(de,{color:"primary"})}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{children:e.jsxs(fe,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h4",{children:"Course Categories"}),o&&e.jsx(f,{color:"primary",onClick:$,children:"Add Category"})]}),e.jsx(he,{columns:Z,data:ie,resourceType:"courses",onView:ae,onEdit:o?D:void 0,onDelete:o?te:void 0,pagination:{currentPage:k,totalPages:ne,onPageChange:re},emptyState:oe})]})}),e.jsxs(M,{placement:"end",visible:J,onHide:()=>{h(!1),g("")},children:[e.jsx(O,{children:e.jsx(B,{children:j?"Edit Category":"Add New Category"})}),e.jsx(H,{children:e.jsxs(je,{onSubmit:ee,children:[w&&e.jsx("div",{className:"alert alert-danger mb-3",children:w}),e.jsx("div",{className:"mb-3",children:e.jsxs("ul",{className:"nav nav-tabs",children:[e.jsx("li",{className:"nav-item",children:e.jsx("button",{className:`nav-link ${C===1?"active":""}`,onClick:t=>P(1,t),type:"button",children:"English"})}),e.jsx("li",{className:"nav-item",children:e.jsx("button",{className:`nav-link ${C===2?"active":""}`,onClick:t=>P(2,t),type:"button",children:"Arabic"})})]})}),e.jsx("div",{style:{display:C===1?"block":"none"},children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Title (English)"}),e.jsx(A,{type:"text",name:"title",value:a.title,onChange:S,required:!0})]})}),e.jsx("div",{style:{display:C===2?"block":"none"},children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Title (Arabic)"}),e.jsx(A,{type:"text",name:"title_ar",value:a.title_ar,onChange:S,required:!0,dir:"rtl"})]})}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Status"}),e.jsxs(me,{name:"status",value:a.status,onChange:S,children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"coming_soon",children:"Coming Soon"})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Image (400x600 recommended)"}),e.jsx(A,{type:"file",accept:"image/*",onChange:t=>{const s=t.target.files[0];u(r=>({...r,imageFile:s}))}}),a.image&&!a.imageFile&&e.jsx("img",{src:`${(I=U.REACT_APP_BASE_URL)==null?void 0:I.replace("/api","")}/${a.image}`,alt:"Current",className:"mt-2 rounded",style:{maxHeight:"120px"}})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2 mt-4",children:[e.jsx(f,{color:"secondary",onClick:()=>h(!1),children:"Cancel"}),e.jsx(f,{color:"primary",type:"submit",children:j?"Update":"Save"})]})]})})]}),e.jsxs(M,{placement:"end",visible:K,onHide:()=>p(!1),children:[e.jsx(O,{children:e.jsx(B,{children:"View Category"})}),e.jsxs(H,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"text-muted mb-2",children:"Category Name (English)"}),e.jsx("p",{className:"fs-5",children:a.title})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"text-muted mb-2",children:"Category Name (Arabic)"}),e.jsx("p",{className:"fs-5",dir:"rtl",children:a.title_ar})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"text-muted mb-2",children:"Slug"}),e.jsx("p",{className:"fs-5",children:a.slug})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"text-muted mb-2",children:"Status"}),e.jsx("span",{className:`badge ${a.status==="coming_soon"?"bg-warning text-dark":"bg-success"}`,children:a.status==="coming_soon"?"Coming Soon":"Active"})]}),a.image&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"text-muted mb-2",children:"Image"}),e.jsx("img",{src:`${(L=U.REACT_APP_BASE_URL)==null?void 0:L.replace("/api","")}/${a.image}`,alt:"Category",className:"rounded",style:{maxHeight:"160px"}})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"text-muted mb-2",children:"Created At"}),e.jsx("p",{className:"fs-5",children:new Date(a.createdAt).toLocaleDateString()})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"text-muted mb-2",children:"Last Updated"}),e.jsx("p",{className:"fs-5",children:new Date(a.updatedAt).toLocaleDateString()})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2 mt-4",children:[e.jsx(f,{color:"secondary",onClick:()=>p(!1),children:"Close"}),o&&e.jsx(f,{color:"warning",onClick:()=>{p(!1),D(a)},children:"Edit"})]})]})]}),e.jsx(ue,{visible:Q,onClose:()=>v(!1),onConfirm:se,itemName:((V=(R=c==null?void 0:c.translations)==null?void 0:R.en)==null?void 0:V.title)||(c==null?void 0:c.title),itemType:"category"})]})};export{_e as default};
