import{r as d,j as e,B as Z,f as F,u as O,C as V}from"./index-wp0-z5g-.js";import{u as $,b as R,r as H,d as S,e as C,c as P,f as g,a as A}from"./DefaultLayout-DdBmS0sh.js";import{C as G,a as U,b as W,c as I,E as K,d as q}from"./ConfirmDeleteModal-DMJz_cck.js";import{f as j,a as m}from"./index.esm-DPbDpRkl.js";import{c as J}from"./cil-pencil-m516yCOw.js";import{c as Q}from"./cil-trash-CBbKHhHb.js";import{C as X,a as Y}from"./CForm-DR_g0405.js";import"./CAlert-D1Sj_uBa.js";import"./cil-user-Ddrdy7PS.js";var ee=["512 512","<polygon fill='var(--ci-primary-color, currentColor)' points='367.997 338.75 271.999 434.747 271.999 17.503 239.999 17.503 239.999 434.745 144.003 338.75 121.376 361.377 256 496 390.624 361.377 367.997 338.75' class='ci-primary'/>"],se=["512 512","<polygon fill='var(--ci-primary-color, currentColor)' points='390.624 150.625 256 16 121.376 150.625 144.004 173.252 240.001 77.254 240.001 495.236 272.001 495.236 272.001 77.257 367.996 173.252 390.624 150.625' class='ci-primary'/>"],re=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M256.072,424l-11.421-11.313-85.808-85.809.053-.054L16,183.928l97.122-97.122,142.9,142.9,142.9-142.9,97.122,97.122L353.243,326.722l-11.361,11.469Zm-.107-45.254.054.053,51.835-51.835L319.2,315.511,450.783,183.928,398.915,132.06l-142.9,142.9-142.9-142.9L61.254,183.928l142.9,142.9-.053.054Z' class='ci-primary'/>"],le=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M183.505,496,86.237,398.73,229.412,255.556,86.237,112.38l97.268-97.27L326.732,158.338l11.316,11.209,85.9,85.9,0,0,.051.05-11.311,11.419-85.9,85.9-.055-.054Zm-52.013-97.27,52.013,52.014L326.629,307.62l.055.054L378.8,255.556l-52.127-52.128-11.308-11.2L183.505,60.366,131.492,112.38,274.667,255.556Z' class='ci-primary'/>"],te=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M479.6,399.716l-81.084-81.084-62.368-25.767A175.014,175.014,0,0,0,368,192c0-97.047-78.953-176-176-176S16,94.953,16,192,94.953,368,192,368a175.034,175.034,0,0,0,101.619-32.377l25.7,62.2L400.4,478.911a56,56,0,1,0,79.2-79.195ZM48,192c0-79.4,64.6-144,144-144s144,64.6,144,144S271.4,336,192,336,48,271.4,48,192ZM456.971,456.284a24.028,24.028,0,0,1-33.942,0l-76.572-76.572-23.894-57.835L380.4,345.771l76.573,76.572A24.028,24.028,0,0,1,456.971,456.284Z' class='ci-primary'/>"];const ie=({category:n,onView:t,onEdit:i,onDelete:h,onReorder:u,hasWritePermission:p})=>{const[x,v]=d.useState(!0),{courses:a}=n,y=r=>{if(r===0)return;const s=[...a];[s[r-1],s[r]]=[s[r],s[r-1]],u(n._id,s.map(o=>o._id))},N=r=>{if(r===a.length-1)return;const s=[...a];[s[r],s[r+1]]=[s[r+1],s[r]],u(n._id,s.map(o=>o._id))};return e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"d-flex align-items-center gap-2 p-2 bg-light rounded cursor-pointer",style:{cursor:"pointer"},onClick:()=>v(!x),children:[e.jsx(j,{icon:x?re:le,size:"sm"}),e.jsxs("h5",{className:"mb-0",children:[n.title," ",e.jsxs("span",{className:"text-medium-emphasis fw-normal fs-6",children:["(",a.length," ",a.length===1?"course":"courses",")"]})]})]}),e.jsx($,{visible:x,children:a.length===0?e.jsx("p",{className:"text-medium-emphasis ms-3 mt-2",children:"No courses in this category"}):e.jsxs(R,{hover:!0,responsive:!0,className:"mt-2",children:[e.jsx(H,{children:e.jsxs(S,{children:[e.jsx(C,{style:{width:50},children:"#"}),e.jsx(C,{children:"Title"}),e.jsx(C,{style:{width:80},children:"Price"}),e.jsx(C,{style:{width:200},children:"Actions"})]})}),e.jsx(P,{children:a.map((r,s)=>e.jsxs(S,{children:[e.jsx(g,{children:s+1}),e.jsx(g,{children:r.name||"N/A"}),e.jsxs(g,{children:["$",r.price]}),e.jsx(g,{children:e.jsxs("div",{className:"d-flex gap-1",children:[p&&e.jsxs(e.Fragment,{children:[e.jsx(m,{color:"light",size:"sm",disabled:s===0,onClick:()=>y(s),title:"Move up",children:e.jsx(j,{icon:se,size:"sm"})}),e.jsx(m,{color:"light",size:"sm",disabled:s===a.length-1,onClick:()=>N(s),title:"Move down",children:e.jsx(j,{icon:ee,size:"sm"})})]}),e.jsx(m,{color:"info",size:"sm",variant:"ghost",onClick:()=>t(r),title:"View",children:e.jsx(j,{icon:te,size:"sm"})}),p&&e.jsxs(e.Fragment,{children:[e.jsx(m,{color:"warning",size:"sm",variant:"ghost",onClick:()=>i(r),title:"Edit",children:e.jsx(j,{icon:J,size:"sm"})}),e.jsx(m,{color:"danger",size:"sm",variant:"ghost",onClick:()=>h(r),title:"Delete",children:e.jsx(j,{icon:Q,size:"sm"})})]})]})})]},r._id))})]})})]})},ae=({visible:n,course:t,onHide:i,onEdit:h,hasWritePermission:u})=>{var p;return t?e.jsxs(G,{placement:"end",visible:n,onHide:i,children:[e.jsx(U,{children:e.jsx(W,{children:"Course Details"})}),e.jsxs(I,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"text-muted mb-2",children:"Title"}),e.jsx("p",{className:"fs-5",children:t.name||"N/A"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"text-muted mb-2",children:"Category"}),e.jsx("p",{className:"fs-5",children:((p=t.category)==null?void 0:p.title)||"N/A"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"text-muted mb-2",children:"Price"}),e.jsxs("p",{className:"fs-5",children:["$",t.price]})]}),t.image&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"text-muted mb-2",children:"Image"}),e.jsx("img",{src:`${Z}/${t.image.data||t.image}`,alt:t.name||"Course",className:"img-fluid rounded",style:{maxWidth:"100%",maxHeight:"200px"}})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2 mt-4",children:[e.jsx(m,{color:"secondary",onClick:i,children:"Close"}),u&&e.jsx(m,{color:"warning",onClick:()=>{i(),h(t)},children:"Edit"})]})]})]}):null},je=()=>{const n=F(),{canWrite:t}=O(),i=t("courses"),[h,u]=d.useState([]),[p,x]=d.useState(!0),[v,a]=d.useState(!1),[y,N]=d.useState(null),[r,s]=d.useState(!1),[o,E]=d.useState(null);d.useEffect(()=>{b()},[]);const b=async()=>{try{x(!0);const l=await A.get("/courses/grouped");l!=null&&l.data&&u(l.data)}catch(l){console.error("Failed to fetch grouped courses:",l)}finally{x(!1)}},z=async(l,c)=>{u(w=>w.map(f=>{if(f._id!==l)return f;const D=c.map(_=>f.courses.find(B=>B._id===_));return{...f,courses:D}}));try{await A.put("/courses/reorder",{orderedIds:c})}catch(w){console.error("Failed to reorder:",w),b()}},L=()=>{i&&n("/courses/new",{state:{isEditing:!1}})},T=l=>{n(`/courses/${l.slug}/edit`,{state:{isEditing:!0}})},k=async()=>{try{await A.delete(`/courses/${o.slug}`),s(!1),E(null),b()}catch(l){console.error("Failed to delete course:",l)}},M=h.reduce((l,c)=>l+c.courses.length,0);return p?e.jsx("div",{className:"d-flex justify-content-center my-5",children:e.jsx(V,{color:"primary"})}):e.jsxs(e.Fragment,{children:[e.jsx(X,{children:e.jsxs(Y,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{children:"Courses"}),M>0&&e.jsxs("p",{className:"text-medium-emphasis",children:[M," courses total"]})]}),i&&e.jsx(m,{color:"primary",onClick:L,children:"Add Course"})]}),h.length===0?e.jsx(K,{title:"No Courses Found",message:"There are no courses in the database yet.",actionLabel:i?"Add Course":null,onAction:i?L:null}):h.map(l=>e.jsx(ie,{category:l,onView:c=>{N(c),a(!0)},onEdit:T,onDelete:c=>{E(c),s(!0)},onReorder:z,hasWritePermission:i},l._id))]})}),e.jsx(ae,{visible:v,course:y,onHide:()=>a(!1),onEdit:T,hasWritePermission:i}),e.jsx(q,{visible:r,onClose:()=>s(!1),onConfirm:k,itemName:o==null?void 0:o.name,itemType:"course"})]})};export{je as default};
