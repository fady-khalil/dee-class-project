import{f as M,e as O,r as u,j as e,C as R}from"./index-DwGczr7l.js";import{a as h,f as P,c as x,d as t,g as d,e as m}from"./index.esm-B4C_3RAI.js";import{a as C,C as H,g as q}from"./DefaultLayout-Bhot9-ca.js";import{C as b,a as N,b as G}from"./CForm-Du01ZZzy.js";import{b as U}from"./CAlert-CC772sW4.js";import{C as z}from"./CFormTextarea-BGakudCY.js";import{C as S}from"./CFormSwitch-Chgf5-Jf.js";import{c as T}from"./cil-trash-CBbKHhHb.js";import"./cil-user-Ddrdy7PS.js";var W=["512 512","<polygon fill='var(--ci-primary-color, currentColor)' points='497.333 239.999 80.092 239.999 176.087 144.004 153.46 121.377 18.837 256 153.46 390.623 176.087 367.996 80.09 271.999 497.333 271.999 497.333 239.999' class='ci-primary'/>"];const re=()=>{const g=M(),{id:y}=O(),p=!!y,[B,A]=u.useState(!1),[v,w]=u.useState(!1),[_,j]=u.useState(null),[F,D]=u.useState(null),[a,f]=u.useState({title:"",title_ar:"",description:"",description_ar:"",monthlyPrice:"",monthlyStripePriceId:"",yearlyPrice:"",yearlyStripePriceId:"",currency:"SAR",features:[""],features_ar:[""],profilesAllowed:1,canDownload:!1,isActive:!0,order:0,isPopular:!1});u.useEffect(()=>{p&&L()},[y]);const L=async()=>{var i,s,l,n;A(!0);try{const o=await C.get(`/admin/plans/${y}`);if(o!=null&&o.success&&o.data){const r=o.data;f({title:r.title||"",title_ar:r.title_ar||"",description:r.description||"",description_ar:r.description_ar||"",monthlyPrice:((i=r.monthlyPrice)==null?void 0:i.toString())||"",monthlyStripePriceId:r.monthlyStripePriceId||"",yearlyPrice:((s=r.yearlyPrice)==null?void 0:s.toString())||"",yearlyStripePriceId:r.yearlyStripePriceId||"",currency:r.currency||"SAR",features:(l=r.features)!=null&&l.length?r.features:[""],features_ar:(n=r.features_ar)!=null&&n.length?r.features_ar:[""],profilesAllowed:r.profilesAllowed||1,canDownload:r.canDownload||!1,isActive:r.isActive!==void 0?r.isActive:!0,order:r.order||0,isPopular:r.isPopular||!1})}else j("Failed to load plan")}catch(o){j("Failed to load plan"),console.error(o)}finally{A(!1)}},c=i=>{const{name:s,value:l,type:n,checked:o}=i.target;f(r=>({...r,[s]:n==="checkbox"?o:l}))},I=(i,s,l=!1)=>{const n=l?"features_ar":"features";f(o=>{const r=[...o[n]];return r[i]=s,{...o,[n]:r}})},k=(i=!1)=>{const s=i?"features_ar":"features";f(l=>({...l,[s]:[...l[s],""]}))},E=(i,s=!1)=>{const l=s?"features_ar":"features";f(n=>({...n,[l]:n[l].filter((o,r)=>r!==i)}))},$=async i=>{i.preventDefault(),w(!0),j(null),D(null);try{const s={...a,monthlyPrice:parseFloat(a.monthlyPrice),yearlyPrice:parseFloat(a.yearlyPrice),profilesAllowed:parseInt(a.profilesAllowed),order:parseInt(a.order),features:a.features.filter(n=>n.trim()),features_ar:a.features_ar.filter(n=>n.trim())};let l;p?l=await C.put(`/admin/plans/${y}`,s):l=await C.post("/admin/plans",s),l!=null&&l.success?(D(p?"Plan updated successfully":"Plan created successfully"),setTimeout(()=>{g("/plans")},1500)):j((l==null?void 0:l.message)||"Failed to save plan")}catch(s){j("Failed to save plan"),console.error(s)}finally{w(!1)}};return B?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"300px"},children:e.jsx(R,{color:"primary"})}):e.jsxs(e.Fragment,{children:[e.jsxs(h,{color:"secondary",variant:"ghost",className:"mb-3",onClick:()=>g("/plans"),children:[e.jsx(P,{icon:W,className:"me-1"}),"Back to Plans"]}),e.jsxs(b,{children:[e.jsx(H,{children:e.jsx("strong",{children:p?"Edit Plan":"Create New Plan"})}),e.jsxs(N,{children:[_&&e.jsx(U,{color:"danger",children:_}),F&&e.jsx(U,{color:"success",children:F}),e.jsxs(G,{onSubmit:$,children:[e.jsxs(x,{children:[e.jsxs(t,{lg:6,children:[e.jsx("h5",{className:"mb-4",children:"Basic Information"}),e.jsxs(x,{children:[e.jsx(t,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(d,{children:"Title (English) *"}),e.jsx(m,{name:"title",value:a.title,onChange:c,required:!0,placeholder:"e.g., Professional"})]})}),e.jsx(t,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(d,{children:"Title (Arabic) *"}),e.jsx(m,{name:"title_ar",value:a.title_ar,onChange:c,required:!0,placeholder:"e.g., احترافي",dir:"rtl"})]})})]}),e.jsxs(x,{children:[e.jsx(t,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(d,{children:"Description (English)"}),e.jsx(z,{name:"description",value:a.description,onChange:c,rows:3,placeholder:"Optional description..."})]})}),e.jsx(t,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(d,{children:"Description (Arabic)"}),e.jsx(z,{name:"description_ar",value:a.description_ar,onChange:c,rows:3,dir:"rtl",placeholder:"وصف اختياري..."})]})})]}),e.jsx("hr",{className:"my-4"}),e.jsx("h5",{className:"mb-4",children:"Pricing"}),e.jsxs("div",{className:"mb-3",children:[e.jsx(d,{children:"Currency"}),e.jsxs(q,{name:"currency",value:a.currency,onChange:c,style:{maxWidth:"150px"},children:[e.jsx("option",{value:"SAR",children:"SAR"}),e.jsx("option",{value:"USD",children:"USD"}),e.jsx("option",{value:"EUR",children:"EUR"})]})]}),e.jsx(b,{className:"bg-light mb-3",children:e.jsxs(N,{children:[e.jsx("h6",{className:"text-primary mb-3",children:"Monthly Pricing"}),e.jsxs(x,{children:[e.jsx(t,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(d,{children:"Price *"}),e.jsx(m,{type:"number",name:"monthlyPrice",value:a.monthlyPrice,onChange:c,required:!0,min:"0",step:"0.01",placeholder:"99"})]})}),e.jsx(t,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(d,{children:"Stripe Price ID *"}),e.jsx(m,{name:"monthlyStripePriceId",value:a.monthlyStripePriceId,onChange:c,required:!0,placeholder:"price_xxxxxxxxxx"})]})})]})]})}),e.jsx(b,{className:"bg-light mb-3",children:e.jsxs(N,{children:[e.jsx("h6",{className:"text-success mb-3",children:"Yearly Pricing"}),e.jsxs(x,{children:[e.jsx(t,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(d,{children:"Price *"}),e.jsx(m,{type:"number",name:"yearlyPrice",value:a.yearlyPrice,onChange:c,required:!0,min:"0",step:"0.01",placeholder:"999"})]})}),e.jsx(t,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(d,{children:"Stripe Price ID *"}),e.jsx(m,{name:"yearlyStripePriceId",value:a.yearlyStripePriceId,onChange:c,required:!0,placeholder:"price_xxxxxxxxxx"})]})})]})]})}),e.jsx("small",{className:"text-muted d-block mb-4",children:"Get Stripe Price IDs from: Stripe Dashboard → Products → Select Product → Copy Price ID"})]}),e.jsxs(t,{lg:6,children:[e.jsx("h5",{className:"mb-4",children:"Plan Settings"}),e.jsxs(x,{children:[e.jsx(t,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(d,{children:"Profiles Allowed"}),e.jsx(q,{name:"profilesAllowed",value:a.profilesAllowed,onChange:c,children:[1,2,3,4,5,6].map(i=>e.jsxs("option",{value:i,children:[i," profile",i>1?"s":""]},i))})]})}),e.jsx(t,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(d,{children:"Display Order"}),e.jsx(m,{type:"number",name:"order",value:a.order,onChange:c,min:"0"}),e.jsx("small",{className:"text-muted",children:"Lower numbers appear first"})]})})]}),e.jsxs("div",{className:"mb-3 p-3 bg-light rounded",children:[e.jsx(S,{id:"canDownload",name:"canDownload",label:"Allow Offline Downloads",checked:a.canDownload,onChange:c,className:"mb-2"}),e.jsx(S,{id:"isPopular",name:"isPopular",label:"Mark as Popular (highlighted in UI)",checked:a.isPopular,onChange:c,className:"mb-2"}),e.jsx(S,{id:"isActive",name:"isActive",label:"Active (visible to users)",checked:a.isActive,onChange:c})]}),e.jsx("hr",{className:"my-4"}),e.jsx("h5",{className:"mb-4",children:"Features"}),e.jsxs(x,{children:[e.jsxs(t,{md:6,children:[e.jsx("h6",{className:"text-muted mb-3",children:"English"}),a.features.map((i,s)=>e.jsxs("div",{className:"d-flex mb-2",children:[e.jsx(m,{value:i,onChange:l=>I(s,l.target.value),placeholder:`Feature ${s+1}`}),a.features.length>1&&e.jsx(h,{color:"danger",variant:"ghost",size:"sm",onClick:()=>E(s),className:"ms-1",children:e.jsx(P,{icon:T})})]},s)),e.jsx(h,{color:"secondary",size:"sm",onClick:()=>k(),className:"mt-2",children:"+ Add Feature"})]}),e.jsxs(t,{md:6,children:[e.jsx("h6",{className:"text-muted mb-3",children:"Arabic"}),a.features_ar.map((i,s)=>e.jsxs("div",{className:"d-flex mb-2",children:[e.jsx(m,{value:i,onChange:l=>I(s,l.target.value,!0),placeholder:`ميزة ${s+1}`,dir:"rtl"}),a.features_ar.length>1&&e.jsx(h,{color:"danger",variant:"ghost",size:"sm",onClick:()=>E(s,!0),className:"ms-1",children:e.jsx(P,{icon:T})})]},s)),e.jsx(h,{color:"secondary",size:"sm",onClick:()=>k(!0),className:"mt-2",children:"+ Add Feature"})]})]})]})]}),e.jsx("hr",{className:"my-4"}),e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx(h,{color:"secondary",onClick:()=>g("/plans"),disabled:v,children:"Cancel"}),e.jsxs(h,{color:"primary",type:"submit",disabled:v,children:[v&&e.jsx(R,{size:"sm",className:"me-2"}),p?"Update Plan":"Create Plan"]})]})]})]})]})]})};export{re as default};
