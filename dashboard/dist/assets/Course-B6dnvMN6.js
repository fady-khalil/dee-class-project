import{f as F,u as I,A as R,r,j as e,C as k,B as H}from"./index-DwGczr7l.js";import{a as y}from"./DefaultLayout-Bhot9-ca.js";import{R as M,C as W,a as z,b as K,c as U,d as _,E as q}from"./ResourceTable-hrfZzuH2.js";import{C as G,a as J}from"./CForm-Du01ZZzy.js";import{a as m}from"./index.esm-B4C_3RAI.js";import"./CAlert-CC772sW4.js";import"./cil-user-Ddrdy7PS.js";const te=()=>{var N;const u=F(),{canWrite:P}=I(),n=P("courses"),[b,g]=R(),[l,v]=r.useState([]),[S,h]=r.useState(!0),[A,o]=r.useState(!1),[t,E]=r.useState(null),[w,d]=r.useState(!1),[c,f]=r.useState(null),[i,D]=r.useState({currentPage:1,totalPages:1,totalCount:0,pageSize:10,hasNextPage:!1,hasPrevPage:!1}),T=[{header:"Title",accessor:s=>s.name||"N/A"},{header:"Category",accessor:s=>{var a;return((a=s.category)==null?void 0:a.title)||"N/A"}},{header:"Price",accessor:"price"}],x=parseInt(b.get("page"))||1;r.useEffect(()=>{C(x)},[x]);const C=async(s=1)=>{try{h(!0);const a=await y.get(`/courses?page=${s}&pageSize=10`);a!=null&&a.data&&v(a.data),a!=null&&a.pagination&&D(a.pagination)}catch(a){console.error("Failed to fetch courses:",a)}finally{h(!1)}},p=()=>{n&&u("/courses/new",{state:{isEditing:!1}})},j=s=>{u(`/courses/${s.slug}/edit`,{state:{isEditing:!0}})},O=s=>{f(s),d(!0)},B=async()=>{try{await y.delete(`/courses/${c.slug}`),d(!1),f(null);const s=i.currentPage;l.length===1&&i.currentPage>1?g({page:(s-1).toString()}):C(s)}catch(s){console.error("Failed to delete course:",s)}},L=s=>{E(s),o(!0)},V=s=>{g({page:s.toString()})},$=e.jsx(q,{title:"No Courses Found",message:"There are no courses in the database yet.",actionLabel:n?"Add Course":null,onAction:n?p:null});return S?e.jsx("div",{className:"d-flex justify-content-center my-5",children:e.jsx(k,{color:"primary"})}):e.jsxs(e.Fragment,{children:[e.jsx(G,{children:e.jsxs(J,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{children:"Courses"}),i.totalCount>0&&e.jsxs("p",{className:"text-medium-emphasis",children:["Showing ",l.length," of ",i.totalCount," courses"]})]}),n&&e.jsx(m,{color:"primary",onClick:p,children:"Add Course"})]}),e.jsx(M,{columns:T,data:l,resourceType:"courses",onView:L,onEdit:n?j:void 0,onDelete:n?O:void 0,pagination:{currentPage:i.currentPage,totalPages:i.totalPages,onPageChange:V},emptyState:$})]})}),t&&e.jsxs(W,{placement:"end",visible:A,onHide:()=>o(!1),children:[e.jsx(z,{children:e.jsx(K,{children:"Course Details"})}),e.jsxs(U,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"text-muted mb-2",children:"Title"}),e.jsx("p",{className:"fs-5",children:t.name||"N/A"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"text-muted mb-2",children:"Category"}),e.jsx("p",{className:"fs-5",children:((N=t.category)==null?void 0:N.title)||"N/A"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"text-muted mb-2",children:"Price"}),e.jsx("p",{className:"fs-5",children:t.price})]}),t.image&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"text-muted mb-2",children:"Image"}),e.jsx("img",{src:`${H}/${t.image.data||t.image}`,alt:t.name||"Course",className:"img-fluid rounded",style:{maxWidth:"100%",maxHeight:"200px"}})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2 mt-4",children:[e.jsx(m,{color:"secondary",onClick:()=>o(!1),children:"Close"}),n&&e.jsx(m,{color:"warning",onClick:()=>{o(!1),j(t)},children:"Edit"})]})]})]}),e.jsx(_,{visible:w,onClose:()=>d(!1),onConfirm:B,itemName:c==null?void 0:c.name,itemType:"course"})]})};export{te as default};
